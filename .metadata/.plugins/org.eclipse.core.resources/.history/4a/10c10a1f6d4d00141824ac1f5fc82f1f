package raphaelpantaleao.katabanckocr;

import static javax.swing.SwingUtilities.invokeAndWait;
import static javax.swing.SwingUtilities.invokeLater;


import java.awt.HeadlessException;
import java.io.File;
import java.io.FileInputStream;
import java.lang.reflect.InvocationTargetException;


import javax.swing.JFileChooser;
import javax.swing.JFrame;


import raphaelpantaleao.katabanckocr.listeners.NonBlokingActionListener;
import raphaelpantaleao.katabanckocr.listeners.ScanFileListener;
import raphaelpantaleao.katabanckocr.models.Document;
import raphaelpantaleao.katabankocr.ui.UIFrame;

public class Main {
	public static void main(String[] args) throws HeadlessException,
			InvocationTargetException, InterruptedException {
		invokeAndWait(() -> {
			final JFileChooser jFileChooser = new JFileChooser() {
				{
					setName("file chooser");
				}
			};
			UIFrame topLevelFrame = new UIFrame("Bank OCR", "BankOCR App");
			Document doc = null;
			topLevelFrame.addScanFileListener(NonBlokingActionListener.invokeLater(new ScanFileListener(doc, topLevelFrame)));
			});

			topLevelFrame
					.addSelectFileListener((event) -> {
						invokeLater(() -> {
							int returnOption = jFileChooser
									.showOpenDialog(topLevelFrame);
							if (returnOption == JFileChooser.APPROVE_OPTION) {
								File file = jFileChooser.getSelectedFile();
								try {
									doc = Document.process(new FileInputStream(
											file));
								} catch (Exception e) {
									throw new RuntimeException(
											"Could not open file", e);
								}
								topLevelFrame.appendInput(doc.unprocessedEntries());
								
							}
						});
					});
			topLevelFrame.setVisible(true);
		});
	}
}
